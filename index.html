<!DOCTYPE html>
<html>
<head>
  <title>IC#CON2 Sensor Data</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .data-box {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      max-width: 300px;
      background: #f9f9f9;
    }
  </style>
</head>
<body>

  <h1>Latest Reading for IC#CON2</h1>
  <div class="data-box">
    <p><strong>Temperature:</strong> <span id="temp">Loading...</span> Â°C</p>
    <p><strong>Humidity:</strong> <span id="hum">Loading...</span> %</p>
    <p><strong>Time:</strong> <span id="time">Loading...</span></p>
  </div>

<script>
  const url = "https://cors-anywhere.herokuapp.com/https://enervisual.com/api/getdata.php?apptoken=cebe600e-91af-45d7-93c6-c964ad77646a";

  async function fetchLatestData() {
    try {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error("Network response was not OK");
      }

      const json = await response.json();
      console.log("Fetched JSON:", json); // ðŸ›  See what's actually in the response

      // âœ… Sanity check: does json.data exist?
      if (!json.data || !Array.isArray(json.data)) {
        throw new Error("Invalid or missing 'data' field in response");
      }

      const data = json.data.filter(item => item.name === "IC#CON2");
      if (data.length === 0) {
        throw new Error("No data found for IC#CON2");
      }

      // Sort by received time (latest first)
      data.sort((a, b) => new Date(b.received_at) - new Date(a.received_at));
      const latest = data[0];

      document.getElementById("temp").textContent = latest.TempC_SHT.toFixed(1);
      document.getElementById("hum").textContent = latest.Hum_SHT.toFixed(1);
      document.getElementById("time").textContent = latest.received_at;

    } catch (error) {
      console.error("Error fetching or processing data:", error);
    }
  }

  fetchLatestData();
</script>


</body>
</html>
